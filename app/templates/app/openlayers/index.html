{% extends 'base.html' %}
{% load static %}

{% block style %}
<!-- https://openlayers.org/download/ -->
<script src="https://cdn.jsdelivr.net/npm/ol@v7.2.2/dist/ol.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.2.2/ol.css">
{% endblock %}

{% block content %}
<div class="container mt-3">
  <a href="https://openlayers.org" target="_blank">https://openlayers.org</a>
  <div id="map" style='width:100%; height:500px; z-index:0;'></div>
  <div id="info"></div>
  <div class="mt-3">
    <button id="zoom-out">Zoom out</button>
    <button id="zoom-in">Zoom in</button>
  </div>
</div>
<script>
  const style = {
    'Point': new ol.style.Style({
      image: new ol.style.Circle({
        fill: new ol.style.Fill({
          color: 'rgba(255,255,0,0.4)',
        }),
        radius: 5,
        stroke: new ol.style.Stroke({
          color: '#ff0',
          width: 1,
        }),
      }),
    }),
    'LineString': new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: '#f00',
        width: 3,
      }),
    }),
    'MultiLineString': new ol.style.Style({
      stroke: new ol.style.Stroke({
        color: '#0f0',
        width: 3,
      }),
    }),
  };
  const vector = new ol.layer.Vector({
    source: new ol.source.Vector({
      url: '{% static "app/gpx/7607339372.gpx" %}',
      format: new ol.format.GPX()
    }),
    style: function (feature) {
      return style[feature.getGeometry().getType()];
    },
  });

  const map = new ol.Map({
    target: 'map',
    layers: [
      new ol.layer.Tile({
        source: new ol.source.OSM()
      }),
      vector
    ],
    view: new ol.View({
      center: ol.proj.fromLonLat([137.59, 36]),  //初期の中心位置 [経度, 緯度]
      zoom: 6 //ズームレベル
    })
  });

  document.getElementById('zoom-out').onclick = () => {
    const view = map.getView();
    const zoom = view.getZoom();
    view.setZoom(zoom - 1);
  };

  document.getElementById('zoom-in').onclick = () => {
    const view = map.getView();
    const zoom = view.getZoom();
    view.setZoom(zoom + 1);
  };
</script>
{% endblock %}